================================================================================
DOCUMENT #20251204-05
DATE: 2025-12-04
TITLE: MASS SCAN RESULTS - ALL 2025 DATES
================================================================================

SCAN SUMMARY:
-------------
- Total dates scanned: 237 dates in 2025
- Cases with |diff| > 0.1 bp: 1,010 cases
- Dates with issues: 235 out of 237 dates (99%)

IMPORTANT CAVEAT:
-----------------
This scan ran calculations for all 237 dates BUT used the SAME curve data
(from Jan 6, 2025) for all calculations. This is the SAME curve versioning
issue we identified earlier.

For accurate results, we would need to regenerate fixtures for EACH date
before running calculations for that date.

================================================================================
WORST OFFENDERS (Top 10)
================================================================================

1. 2025-08-27 - BGN 10x10: -12.84 bp difference
   Computed: -17.110 bp | Database: -4.272 bp

2. 2025-05-27 - TIBOR 1x4: +11.48 bp difference
   Computed: +0.917 bp | Database: -10.563 bp

3. 2025-05-28 - TIBOR 1x4: +11.43 bp difference
   Computed: +0.907 bp | Database: -10.525 bp

4. 2025-08-26 - TIBOR 2x3: -11.20 bp difference
   Computed: -17.045 bp | Database: -5.843 bp

5. 2025-08-27 - BGN 10x20: -10.34 bp difference
   Computed: -14.949 bp | Database: -4.606 bp

6. 2025-08-27 - TIBOR 2x3: -10.32 bp difference
   Computed: -17.038 bp | Database: -6.717 bp

7. 2025-09-08 - BGN 10x20: -9.99 bp difference
   Computed: -13.374 bp | Database: -3.386 bp

8. 2025-06-26 - TIBOR 2x3: -9.63 bp difference
   Computed: -16.756 bp | Database: -7.129 bp

9. 2025-07-16 - BGN 10x20: -9.62 bp difference
   Computed: -13.370 bp | Database: -3.748 bp

10. 2025-08-25 - BGN 10x20: -9.48 bp difference
    Computed: -13.364 bp | Database: -3.888 bp

================================================================================
PATTERN ANALYSIS
================================================================================

EARLY 2025 (Jan-Feb):
---------------------
- Errors: 0.1 - 4.2 bp
- Pattern: Moderate discrepancies
- Likely cause: Jan 6 curves used, actual dates vary slightly

SPRING 2025 (Mar-May):
----------------------
- Errors: 0.1 - 11.5 bp
- Pattern: Increasing discrepancies, especially TIBOR
- Cause: Interest rate environment shifted significantly

SUMMER 2025 (Jun-Aug):
----------------------
- Errors: Up to 12.8 bp
- Pattern: LARGEST discrepancies observed
- Cause: Major divergence between Jan 6 curves and summer market conditions
- Note: Some TIBOR spreads show POSITIVE values (unusual)

FALL 2025 (Sep-Nov):
--------------------
- Errors: 2 - 10 bp
- Pattern: Still significant but less than summer peak

DECEMBER 2025 (Recent):
-----------------------
- Errors: 4 - 9 bp
- Pattern: Large errors despite being recent dates
- Surprising: Expected better accuracy for recent dates

================================================================================
KEY INSIGHTS
================================================================================

1. CURVE DATA MISMATCH CONFIRMED ACROSS ALL DATES
   Using Jan 6, 2025 curve data to calculate spreads for dates throughout
   the year produces errors ranging from 0.1 bp to 12.8 bp.

2. MARKET CONDITIONS CHANGED SIGNIFICANTLY IN 2025
   - Jan-Feb: Relatively stable (2-4 bp errors)
   - Summer: Major shifts (10-13 bp errors)
   - Recent: Still elevated (8-9 bp errors)

3. TIBOR SPREADS SHOW UNUSUAL BEHAVIOR
   Some TIBOR calculations produce POSITIVE spreads when database shows
   NEGATIVE spreads, indicating fundamental curve shape differences.

4. EVEN RECENT DATES SHOW LARGE ERRORS
   December 2025 dates still show 8-9 bp errors, suggesting either:
   - Curve data continues to be updated/refined
   - Database uses different data sources
   - Our fixture generation isn't querying correctly

================================================================================
RECOMMENDATIONS
================================================================================

IMMEDIATE NEXT STEP:
--------------------
Test a FEW specific dates by regenerating fixtures FOR EACH DATE:

Priority test dates:
1. 2025-08-27 (worst offender: 12.8 bp error)
2. 2025-05-27 (TIBOR anomaly: +11.5 bp error)
3. 2025-12-03 (recent date: 8.6 bp error)

This will determine if:
✅ Algorithm is correct (we believe it is)
✅ Curve matching fixes the issue (proven for Jan 6 and Oct 31)
❓ Database has accurate curve data for ALL dates
❓ Fixture generation correctly queries historical curves

LONG-TERM SOLUTIONS:
--------------------
1. Modify find_large_diffs.py to regenerate fixtures for each date
   - Pros: Accurate results, proper validation
   - Cons: Very slow (237 dates × fixture generation time)

2. Update basiscalc to query curves dynamically from database
   - Pros: Always uses correct curve data
   - Cons: Requires database connection, slower than fixtures

3. Implement curve versioning in database queries
   - Pros: Can retrieve historical curve snapshots
   - Cons: Requires database schema understanding

================================================================================
HYPOTHESIS TO TEST
================================================================================

Based on Jan 6 success (0.055 bp error) and Oct 31 success (0.068 bp error),
we hypothesize that:

IF we regenerate fixtures for date X
AND run basiscalc for date X
THEN we should achieve < 0.1 bp accuracy vs database

This hypothesis should be tested on:
- A summer date (high error in mass scan)
- A spring date (moderate error in mass scan)
- A December date (recent but still large error)

If hypothesis holds → Algorithm is fully validated ✅
If hypothesis fails → Need to investigate database curve data quality ⚠️

================================================================================
CONCLUSION
================================================================================

The mass scan results do NOT invalidate our earlier findings. They confirm
that using MISMATCHED curve data produces LARGE errors, exactly as we
discovered in the investigation.

The scan proves:
1. ✅ Curve data matching is CRITICAL for accuracy
2. ✅ Jan 6 curves don't work for other dates (as expected)
3. ⚠️  Need to test if database HAS accurate curves for all dates
4. ⚠️  Need proper date-matched fixture generation for validation

Next step: Test 3-5 specific dates with date-matched fixtures to validate
that the algorithm works correctly across different market conditions.

================================================================================
